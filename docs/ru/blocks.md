# Блочное программирование Клевера

Возможность блочного визуального программирования автономных полетов Клевера добавлена в [образ для RPi](image.md), начиная с версии **0.21**. Реализация блочного программирования основана на [Google Blockly](https://developers.google.com/blockly). Интеграция Blockly в Клевер позволяет понизить входной порог в программирование автономных полетов до минимального уровня.

Для того, чтобы открыть интерфейс блочного программирования в Клевере, [подключитесь к Клеверу по Wi-Fi](wifi.md) и перейдите на страницу http://192.168.11.1:8080/clover_blocks/ либо нажмите ссылку *Blocks Programming* на основной веб-странице Клевера.

Аргумент `blocks` в launch-файле Клевера (`~/catkin_ws/src/clover/clover/launch/clover.launch`) [должен быть в значении](cli.md#editing) `true`:

```xml
<arg name="blocks" default="true"/>
```

Интерфейс выглядит следующим образом:

<img src="../assets/blocks/blocks.png" width=600>

Соберите необходимую программу из блоков в меню слева а затем нажмите кнопку *Run* для ее запуска. Также вы можете просмотреть сгенерированный код на языке Python, переключившись во вкладку *Python*.

Кнопка *Stop* позволяет остановить программу. Нажатие кнопки *Land* также останавливает программу и сажает дрон.

## Блоки

Набор блоков приблизительно аналогичен набору ROS-сервисов [API автономных полетов Клевера](simple_offboard.md). В этом разделе приведено описание некоторых из них.

Блоки Клевера поделены на 4 категории:

* *Flight* – команды, имеющие отношение к полету.
* *State* – блоки, позволяющие получить те или иные параметры текущего состояния коптера.
* *LED* – блоки для управления [LED-лентой](leds.md).
* *GPIO* – блоки для работы с [GPIO-пинами](gpio.md).

В остальных категориях находятся стандартные блоки Google Blockly.

### take_off

Взлететь на указанную высоту в метрах. Высота может быть произвольным блоком, возвращающим числовое значение.

Флаг `wait` определяет, должен ли дрон ожидать окончания взлета перед выполнением следующего блока.

<img src="../assets/blocks/take-off.png" srcset="../assets/blocks/take-off.png 2x">

### navigate

Прилететь в заданную точку.

Флаг `wait` определяет, должен ли дрон ожидать завершения полета в точку перед выполнением следующего блока.

<img src="../assets/blocks/navigate.png" srcset="../assets/blocks/navigate.png 2x">

В блоке задается также [система координат](frames.md), в которой задана целевая точка. TODO

### land

Произвести посадку.

Флаг `wait` определяет, должен ли дрон ожидать окончания посадки перед выполнением следующего блока.

<img src="../assets/blocks/land.png" srcset="../assets/blocks/land.png 2x">

### wait

Ожидать заданное время в секундах. Время ожидания может быть произвольным блоком, возвращающим числовое значение.

<img src="../assets/blocks/wait.png" srcset="../assets/blocks/wait.png 2x">

### get_position

<img src="../assets/blocks/get-position.png" srcset="../assets/blocks/get-position.png 2x">

### set_effect

<img src="../assets/blocks/set-effect.png" srcset="../assets/blocks/set-effect.png 2x">

<img src="../assets/blocks/random-color.png" srcset="../assets/blocks/random-color.png 2x">

### GPIO-блоки

TODO

Подробнее о GPIO-пинах Raspberry Pi вы можете прочитать в [соответствующей статье](gpio.md).
